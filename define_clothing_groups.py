import pickle
import os

print("Начинается выполнение define_clothing_groups.py...")

# Мы определим основные категории одежды
# И список предметов, которые попадают в каждую категорию
clothing_categories_map = {
    "Верхняя одежда (очень теплая)": [
        "утепленный пуховик", "пуховик", "пальто", "зимняя куртка", "валенки", "плотный свитер" # Добавляем плотный свитер как очень теплый элемент
    ],
    "Верхняя одежда (легкая)": [
        "легкая куртка","ветровка", "дождевик", "джинсовая куртка", "кожаная куртка", "плащ", "пиджак"
    ],
    "Верх (основной)": [
        "свитер", "кофта", "кардиган", "толстовка", "флис", "рубашка", "поло", "блузка", "туника"
    ],
    "Верх (легкий)": [
        "футболка", "майка", "купальный костюм", "купальник", "плавки"
    ],
    "Низ (теплый)": [
        "брюки", "джинсы", "легинсы", "спортивный костюм"
    ],
    "Низ (легкий)": [
        "шорты", "юбка", "легкое платье", "платье", "комбинезон"
    ],
    "Обувь (зимняя)": [
        "зимние ботинки", "сапоги", "ботинки"
    ],
    "Обувь (демисезонная)": [
        "кроссовки", "кеды", "полуботинки", "туфли", "мокасины"
    ],
    "Обувь (летняя)": [
        "сандалии"
    ],
    "Головные уборы (зимние)": [
        "шапка", "балаклава", "капюшон"
    ],
    "Головные уборы (летние)": [
        "кепка", "шляпа", "бандана", "солнцезащитные очки"
    ],
    "Перчатки/Варежки": [
        "перчатки", "варежки", "митенки"
    ],
    "Шарф/Палантин": [
        "шарф", "снуд", "палантин", "шаль"
    ],
    "Белье/Носки": [ # Для термобелья и теплых носков, которые не видно, но они важны
        "термобелье", "шерстяные носки", "носки", "чулки", "пижама", "халат"
    ],
    "Дополнительно (от осадков)": [
        "зонт", "дождевик", "резиновые сапоги" # Резиновые сапоги будут здесь, т.к. они специфичны для осадков
    ]
}

# Создаем обратное отображение: от конкретного предмета к его категории
item_to_category = {}
for category, items in clothing_categories_map.items():
    for item in items:
        item_to_category[item] = category

# Теперь, пересоздадим clothing_mapping на основе КАТЕГОРИЙ
# И создадим clothing_groups.pkl для детализации
unique_categories = sorted(list(clothing_categories_map.keys()))

print(f"\nОпределено {len(unique_categories)} категорий одежды:")
for category in unique_categories:
    print(f"- {category}")

# Сохраняем НОВЫЙ clothing_mapping.pkl (для модели)
with open('clothing_mapping.pkl', 'wb') as f:
    pickle.dump(unique_categories, f)
print("\nСловарь соответствий категорий одежды (для модели) сохранен в clothing_mapping.pkl")

# Сохраняем mapping для детализации (для predict_clothing.py)
with open('clothing_groups.pkl', 'wb') as f:
    pickle.dump(clothing_categories_map, f)
print("Словарь детализации категорий одежды сохранен в clothing_groups.pkl")

print("\nВыполнение define_clothing_groups.py завершено.")
print("Теперь можно запускать generate_synthetic_data.py и process_data.py.")